<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Account</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"/>
    <meta name="viewport" content="initial-scale=1, width=device-width" />
    <link id="global-theme" rel="stylesheet" href="./static/css/global.css" />
    <link id="index-theme" rel="stylesheet" href="./static/css/account/index-light.css" />
    <link id="popupSearch" rel="stylesheet" href="{{url_for('static', filename='css/modal/modal-search.css')}}"/>
    <link id="popupDatabase" rel="stylesheet" href="{{url_for('static', filename='css/modal/modal-database.css')}}"/>
    <script type="text/javascript" src="{{url_for('static', filename='js/script.js')}}"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/3.0.4/socket.io.js" integrity="sha512-aMGMvNYu8Ue4G+fHa359jcPb1u+ytAF+P2SCb+PxrjCdO3n3ZTxJ30zuH39rimUggmTwmh2u7wvQsDTHESnmfQ==" crossorigin="anonymous"></script>
  </head>
  <body>
    <div class="account" data-animate-on-scroll>
      <div class="container" data-animate-on-scroll>
        <header class="header">
          <a href="/" class="logo" style="text-decoration: none" data-animate-on-scroll>
            <img id="logoIconId" class="logo-icon" alt="" src="{{url_for('static', filename='images/header/light/logo-blue-1@2x.png')}}"/>
            <h1 class="site-name">UniPeptides</h1>
          </a>
          <div class="setting-btns">
            <button class="small-btn" onclick="themeChange('account')">
              <img class="small-icon-btn" alt="" src="{{url_for('static', filename='images/header/light/night.svg')}}" />
            </button>
            <button class="small-btn">
              <img class="small-icon-btn" alt="" src="{{url_for('static', filename='images/header/light/help.svg')}}" />
            </button>
            <button class="small-btn">
              <img class="small-icon-btn" alt="" src="{{url_for('static', filename='images/header/light/united-kingdom.svg')}}"/>
            </button>
          </div>
        </header>
        <div class="content">
          <div class="user">
            <b class="user-name">Hi, {{ username }}!</b>
            <div class="frame-parent">
              <div class="button-parent">
                <button class="btn-select">
                  <span class="btn-text">Select all</span>
                </button>
                <button class="btn-download">
                  <span class="btn-text">Download selected</span>
                </button>
              </div>
              <div class="button-group">
                <button class="btn-deleate">
                  <span class="btn-text">Deleate selected</span>
                </button>
                <a href="{{ url_for('logout')}}" class="btn-logout" style="text-decoration: none;">
                  <span class="btn-text">Log out</span>
                </a>
              </div>
            </div>
          </div>
          <div class="results">
            <div class="search-block">
              <b class="block-name">Search for peptides</b>
              <div class="result-wrapper" id="wrapper">
                {% if results %}
                {% for result in results %}
                <div class="result" id="{{ result.id }}">
                  <input class="checkbox" type="checkbox" />
                  <span class="date"
                        onclick="openResult('{{ result.date }}', '{{ result.proteins }}', '{{ result.peptides }}')">
                        {{ result.date }}
                  </span>
                  <div class="action-btns"> 
                    <a href="{{ url_for('get_result', result_id=result.id)}}" class="small-btn">
                      <img class="small-icon-btn" alt="" src="{{url_for('static', filename='images/download.svg')}}"/>
                    </a>
                    <button class="small-btn-red" onclick="delResult('{{ result.id }}')">
                      <img class="small-icon-btn" alt="" src="{{url_for('static', filename='images/basket.svg')}}"/>
                    </button>
                  </div>
                </div>
                {% endfor %}
                {% endif %}
              </div>
            </div>
            <div class="search-block">
              <b class="block-name">Requests to add to the database</b>
              <div class="result-wrapper">
                {% if requests %}
                {% for request in requests %}
                <div class="result" id="{{ request.id }}">
                  <span class="date">{{ request.date }}</span>
                  <span class="request_status">Сonsideration</span>
                </div>
                {% endfor %}
                {% endif %}
                <div class="result" id="">
                  <span class="date">{{ request.date }}</span>
                  <span class="request_status">Accepted</span>
                </div>
                <div class="result" id="">
                  <span class="date">{{ request.date }}</span>
                  <span class="request_status">Cancelled</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div id="modalSearchPopup" class="popup-overlay" style="display: none">
      <div class="modal-search" data-animate-on-scroll>
        <div class="close-btn-group">
          <button class="close-btn1" onclick=closePopup("modalSearchPopup") data-animate-on-scroll>
            <label class="x1">X</label>
          </button>
          <h1 class="h1" id="res_date"></h1>
        </div>
        <div class="proteins-q14050-p05760-p123-parent">
          <div class="proteins-q14050-p05760-container">
            <b>Proteins:</b>
            <span class="text_span" id="proteins_value"></span>
          </div>
          <div class="proteins-q14050-p05760-container">
            <b>Peptides:</b>
            <span class="text_span" id="peptides_value"></span>
          </div>
        </div>
      </div>
    </div>

    <div id="modalDatabasePopup" class="popup-overlay" style="display: none">
      <div class="modal-database" data-animate-on-scroll>
        <div class="close-btn-parent">
          <button class="close-btn" onclick=closePopup("modalDatabasePopup") data-animate-on-scroll>
            <label class="x">X</label>
          </button>
          <h1 class="h1">Date</h1>
        </div>
        <div class="peptides-wrapper">
          <div class="peptides">Peptides:</div>
        </div>
      </div>
    </div>

    <script>

      Animation();
      function delResult(result) {
        result_time = document.getElementById(result);
        $(document).ready(function(){
          var socket = io();
          socket.emit('delete result', {data: result});
          result_time.remove();
          return false;
        });
      }
      function setColor() {
        let status = document.getElementsByClassName("request_status");
        for (let i = 0; i < status.length; i++) {
          console.log(status.length);
          if (status[i].innerHTML === 'Сonsideration') {
            status[i].style.color = "#ed9d24";
            status[i].innerHTML === '<b>Сonsideration</b>'
          };
          if (status[i].innerHTML === 'Accepted') {
            status[i].style.color = "#40ff76";
            status[i].innerHTML === '<b>Accepted</b>'
          };
          if (status[i].innerHTML === 'Cancelled') {
            status[i].style.color = "#ff4040";
            status[i].innerHTML === '<b>Cancelled</b>'
          }
        }
      }
      var interval = setInterval(setColor,100);
      setTimeout(function( ) { clearInterval( interval ); console.log('interval') }, 3000);

      function openResult(date, proteins_val, peptides_val){
          res_date = document.getElementById("res_date");
          peptides = document.getElementById("peptides_value");
          proteins = document.getElementById("proteins_value");
          peptides.innerHTML = peptides_val;
          proteins.innerHTML = proteins_val;
          res_date.innerHTML = date;
          var popup = document.getElementById("modalSearchPopup");
          if (!popup) return;
          var popupStyle = popup.style;
          if (popupStyle) {
            popupStyle.display = "flex";
            popupStyle.zIndex = 100;
            popupStyle.backgroundColor = "rgba(113, 113, 113, 0.3)";
            popupStyle.alignItems = "center";
            popupStyle.justifyContent = "center";
          }
          popup.setAttribute("closable", "");

          var onClick =
            popup.onClick ||
            function (e) {
              if (e.target === popup && popup.hasAttribute("closable")) {
                popupStyle.display = "none";
              }
            };
          popup.addEventListener("click", onClick);
      }

      var result1 = document.getElementById("result1");
      if (result1) {
        result1.addEventListener("click", function () {
          var popup = document.getElementById("modalDatabasePopup");
          if (!popup) return;
          var popupStyle = popup.style;
          if (popupStyle) {
            popupStyle.display = "flex";
            popupStyle.zIndex = 100;
            popupStyle.backgroundColor = "rgba(113, 113, 113, 0.3)";
            popupStyle.alignItems = "center";
            popupStyle.justifyContent = "center";
          }
          popup.setAttribute("closable", "");

          var onClick =
            popup.onClick ||
            function (e) {
              if (e.target === popup && popup.hasAttribute("closable")) {
                popupStyle.display = "none";
              }
            };
          popup.addEventListener("click", onClick);
        });
      }
      </script>
  </body>
</html>
